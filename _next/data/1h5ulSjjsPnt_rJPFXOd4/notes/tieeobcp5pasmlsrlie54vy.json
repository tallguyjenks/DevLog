{"pageProps":{"note":{"id":"tieeobcp5pasmlsrlie54vy","title":"Clustered Index","desc":"","updated":1641412803998,"created":1641105063932,"stub":false,"isDir":false,"custom":{"stub":false,"isDir":false},"fname":"s.q.tsql.dbos.indexes.clustered-index","type":"note","vault":{"fsPath":"DevLog"},"contentHash":"f24e4b597cc1469aedb77c42fc493419","links":[{"from":{"fname":"s.q.tsql.dbos.indexes.non-clustered-index","vaultName":"DevLog"},"type":"backlink","position":{"start":{"line":7,"column":324,"offset":992},"end":{"line":7,"column":386,"offset":1054},"indent":[]},"value":"s.q.tsql.dbos.indexes.clustered-index","alias":"TSQL Clustered Index"}],"anchors":{},"children":[],"parent":"d3h5sf7t3oq8w2esmcg2npf","data":{}},"body":"<h1 id=\"clustered-index\"><a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#clustered-index\"></a>Clustered Index</h1>\n<blockquote>\n<p>A clustered index defines the order in which data is physically stored in a table. Table data can be sorted in only way, therefore, there can be only one clustered index per table. In SQL Server, the primary key constraint automatically creates a clustered index on that particular column.</p>\n</blockquote>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> schooldb\n          \n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> student <span class=\"token punctuation\">(</span>\n    id <span class=\"token keyword\">INT</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">-- &#x3C;==</span>\n    name <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    gender <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    DOB <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    total_score <span class=\"token keyword\">INT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    city <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">--------------------------------</span>\n<span class=\"token keyword\">USE</span> schooldb\n          \n<span class=\"token keyword\">EXECUTE</span> sp_helpindex student\n</code></pre>\n<p>The above query will return this result:</p>\n<p><img src=\"/DevLog/assets/images/Pasted_image_20211201134834.png\" alt=\"alt\"></p>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">USE</span> schooldb\n          \n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> student\n \n<span class=\"token keyword\">VALUES</span>  \n<span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Kate'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Female'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'03-JAN-1985'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Liverpool'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \n<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Jon'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Male'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'02-FEB-1974'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">545</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Manchester'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Wise'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Male'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'11-NOV-1987'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">499</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Manchester'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \n<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Sara'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Female'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'07-MAR-1988'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">600</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Leeds'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \n<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Jolly'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Female'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'12-JUN-1989'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'London'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Laura'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Female'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22-DEC-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Liverpool'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Joseph'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Male'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'09-APR-1982'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">643</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'London'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Alan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Male'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'29-JUL-1993'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'London'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \n<span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Mice'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Male'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'16-AUG-1974'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">543</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Liverpool'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Elis'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Female'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'28-OCT-1990'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Leeds'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">-- NOTE id's in random order upon insertion</span>\n\n<span class=\"token comment\">--------------------------------</span>\n<span class=\"token keyword\">USE</span> schooldb\n          \n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> student\n</code></pre>\n<p><img src=\"/DevLog/assets/images/Pasted_image_20211201134934.png\" alt=\"alt\"></p>\n<p>Creating a new Clustered index:</p>\n<pre class=\"language-sql\"><code class=\"language-sql\">\n<span class=\"token comment\">-- Since there can only be 1 per table, you'll need to delete the original one on the Primary Key</span>\n\n<span class=\"token keyword\">use</span> schooldb\n \n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">CLUSTERED</span> <span class=\"token keyword\">INDEX</span> IX_tblStudent_Gender_Score\n<span class=\"token keyword\">ON</span> student<span class=\"token punctuation\">(</span>gender <span class=\"token keyword\">ASC</span><span class=\"token punctuation\">,</span> total_score <span class=\"token keyword\">DESC</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<blockquote>\n<p>The characteristics of the best clustering keys can be summarized in few points that are followed by most of the designers:\n<br>\n<strong>Short</strong>: Although SQL Server allows us to add up to 16 columns to the clustered index key, with maximum key size of 900 bytes, the typical clustered index key is much smaller than what is allowed, with as few columns as possible. The wide Clustered index key will also affect all non-clustered indexes built over that clustered index, as the clustered index key will be used as a lookup key for all the non-clustered indexes pointing to it.\n<strong>Static</strong>: It is recommended to choose the columns that are not changed frequently in the clustered index key. Changing the clustered index key values means that the whole row will be moved to the new proper page to keep the data values in the correct order.\n<strong>Increasing</strong>: Using an increasing column, such as the IDENTITY column, as a clustered index key will help in improving the INSERT process, that will directly insert the new values at the logical end of the table. This highly recommended choice will help in reducing the amount of memory required for the page buffers, minimize the need to split the page into two pages to fit the newly inserted values and the fragmentation occurrence, that required rebuilding or reorganizing the index again.\n<strong>Unique</strong>: It is recommended to declare the clustered index key column or combination of columns as unique to improve the queries performance. Otherwise, SQL Server will automatically add a uniqueifier column to enforce the clustered index key uniqueness.\n<strong>Accessed</strong> frequently: This is due to the fact that the rows will be stored in the clustered index in a sorted order based on that index key that is used to access the data.\n<strong>Used in the ORDER BY clause</strong>: In this case, no need for the SQL Server Engine to sort the data in order to display it, as the rows are already sorted based on the index key used in the ORDER BY clause.</p>\n</blockquote>\n<hr>\n<ul>\n<li>Reference:\n<ul>\n<li><a href=\"https://www.sqlshack.com/what-is-the-difference-between-clustered-and-non-clustered-indexes-in-sql-server/\">https://www.sqlshack.com/what-is-the-difference-between-clustered-and-non-clustered-indexes-in-sql-server/</a></li>\n<li><a href=\"https://www.sqlshack.com/designing-effective-sql-server-clustered-indexes/\">https://www.sqlshack.com/designing-effective-sql-server-clustered-indexes/</a></li>\n</ul>\n</li>\n</ul>\n<hr>\n<strong>Backlinks</strong>\n<ul>\n<li><a href=\"/DevLog/notes/zpxmpcv9mqarzsq3hgjwpim\">Non Clustered Index (DevLog)</a></li>\n</ul>","noteIndex":{"id":"root","title":"root","desc":"","updated":1641013093667,"created":1595961348801,"stub":false,"custom":{"stub":false,"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"DevLog"},"contentHash":"b0b26527a2962dbb8bd5fb9a53ad702f","links":[],"anchors":{},"children":["rzqe5mjn3q2zfscw1roxr20","Bl9NeJmftBQJyJA3X4a6u","inm1S24v2GcN3Quf7gzDb","fmx7cfcdzale0ezna61yq5z","q6tr8q7gahfijix2ktlhcu3","yah6spesmpstech2ue2k3lq","6pxwlugphnw6vm4t8kn0j5p","i17wi8y2hgivywe08h6q6it","1st35wikvph2aew8aana21u","mijr0wvj3qz0mt9pv9xo1jv","qaf8v120h0ffvbowysjxw50","sh4851li2rsrhx47wwsirgv","fwqjigvqyfxiyl3pbpjvgdw","pxdvvln974xhe8w0alh0hoy","n6yddb1smrac5ll3l1y6wbd","g5dllyqoqkenoiz3opalzu6","kbwt8ucy0yh6bo8fl0kv9iw","beykavbe22agsufmm03hu0c","2uvuqa3c15o5r4j7sqadqvr","yr6gzhx0bhzyec6f52y66vf","4no90tcdswtuwmjm0bxnetx"],"parent":null,"data":{},"body":"\nThe hyperfixated rabbit hole diving knowledge base that is my brain looking at technology.\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"randomNote":{},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"sterkere","visibility":"private"},{"fsPath":"Norsk","visibility":"private"},{"fsPath":"DevLog"}],"journal":{"dailyDomain":"log","name":"daily","dateFormat":"yyyy.MM.dd","addBehavior":"childOfCurrent"},"scratch":{"name":"scratch","dateFormat":"yyyy.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"todoIntegration":true,"name":"task","dateFormat":"yyyy.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"wip","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.95.1","enableFullHierarchyNoteTitle":false,"enableHandlebarTemplates":false,"templateHierarchy":"template","enableSmartRefs":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"theme":"custom","enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"assetsPrefix":"/DevLog","copyAssets":true,"siteHierarchies":["root"],"enableSiteLastModified":true,"siteRootDir":"docs","siteUrl":"https://{GITHUB_USERNAME}.github.io","enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"duplicateNoteBehavior":{"action":"useVault","payload":["DevLog"]},"writeStubs":false,"seo":{"title":"Dendron","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"master","editViewMode":"tree"},"enablePrettyLinks":true,"enableTaskNotes":true,"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}
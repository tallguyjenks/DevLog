{"pageProps":{"note":{"id":"qosdqas2tp7876xom9u4gvt","title":"Setting up Queries for Ablation Testing","desc":"","updated":1646691170315,"created":1646691075569,"custom":{},"fname":"s.q.tsql.tips-tricks.setting-up-queries-for-ablation-testing","type":"note","vault":{"fsPath":"DevLog"},"contentHash":"de6aa7b81a68e8abb8fc2e9156831aba","links":[],"anchors":{"an-example-of-ablation-testing":{"type":"header","text":"An Example Of Ablation Testing","value":"an-example-of-ablation-testing","line":24,"column":0,"depth":2}},"children":[],"parent":"8zi5l8v14vld0duayretzxl","data":{}},"body":"<h1 id=\"setting-up-queries-for-ablation-testing\"><a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#setting-up-queries-for-ablation-testing\"></a>Setting up Queries for Ablation Testing</h1>\n<blockquote>\n<p>Sometimes you write a complex SQL statement that doesnâ€™t work, and you do not know why. The best way to figure out what is wrong is by ablation testing.\nAblation testing is where you turn things off until you isolate the problem. In the case of SQL queries, this involves commenting out lines of a complex WHERE clause (or JOIN) until you find the thing that is not working as designed.\nHowever, if your WHERE clause starts with a filter, you have to move it so you can comment it out. If you start your WHERE clause with 1 = 1, which is always true, then you preserve syntax and can easily comment out your filters without having to rewrite your code.\nNo matter how simple your SQL statement is, I recommend that you get in the habit of creating ablation testing ready SQL statements.</p>\n<p>-- <a href=\"https://tutorials.massstreet.net/v/transact-sql/solutions-to-real-world-problems/lesson-50.-setting-up-queries-for-ablation-testing\">https://tutorials.massstreet.net/v/transact-sql/solutions-to-real-world-problems/lesson-50.-setting-up-queries-for-ablation-testing</a></p>\n</blockquote>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">USE</span> AdventureWorks2016\n\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> Sales<span class=\"token punctuation\">.</span>SalesOrderHeader soh\n<span class=\"token keyword\">JOIN</span> Sales<span class=\"token punctuation\">.</span>SalesOrderDetail sod <span class=\"token keyword\">ON</span> soh<span class=\"token punctuation\">.</span>SalesOrderID <span class=\"token operator\">=</span> sod<span class=\"token punctuation\">.</span>SalesOrderID\n<span class=\"token keyword\">WHERE</span> <span class=\"token number\">1</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n</code></pre>\n<h2 id=\"an-example-of-ablation-testing\"><a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#an-example-of-ablation-testing\"></a>An Example Of Ablation Testing</h2>\n<p>Here we suspect that two lines in the WHERE clause are causing our query to act up.</p>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">USE</span> AdventureWorks2016\n\n<span class=\"token keyword\">SELECT</span>\n    CONCAT<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span>FirstName<span class=\"token punctuation\">,</span> <span class=\"token string\">' '</span><span class=\"token punctuation\">,</span>p<span class=\"token punctuation\">.</span>LastName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> SalesPerson<span class=\"token punctuation\">,</span>\n    DATEPART<span class=\"token punctuation\">(</span><span class=\"token keyword\">month</span><span class=\"token punctuation\">,</span>soh<span class=\"token punctuation\">.</span>OrderDate<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> MonthOfSale<span class=\"token punctuation\">,</span>\n    <span class=\"token function\">SUM</span><span class=\"token punctuation\">(</span>sod<span class=\"token punctuation\">.</span>LineTotal<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> TotalSales\n<span class=\"token keyword\">FROM</span> Person<span class=\"token punctuation\">.</span>Person p\n    <span class=\"token keyword\">JOIN</span> Sales<span class=\"token punctuation\">.</span>SalesPerson sp <span class=\"token keyword\">ON</span> p<span class=\"token punctuation\">.</span>BusinessEntityID <span class=\"token operator\">=</span> sp<span class=\"token punctuation\">.</span>BusinessEntityID\n    <span class=\"token keyword\">JOIN</span> Sales<span class=\"token punctuation\">.</span>SalesOrderHeader soh <span class=\"token keyword\">ON</span> sp<span class=\"token punctuation\">.</span>BusinessEntityID <span class=\"token operator\">=</span> soh<span class=\"token punctuation\">.</span>SalesPersonID\n    <span class=\"token keyword\">JOIN</span> Sales<span class=\"token punctuation\">.</span>SalesOrderDetail sod <span class=\"token keyword\">ON</span> soh<span class=\"token punctuation\">.</span>SalesOrderID <span class=\"token operator\">=</span> sod<span class=\"token punctuation\">.</span>SalesOrderDetailID\n<span class=\"token keyword\">WHERE</span> <span class=\"token number\">1</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    <span class=\"token operator\">AND</span> sp<span class=\"token punctuation\">.</span>Bonus <span class=\"token operator\">BETWEEN</span> <span class=\"token number\">3000.00</span> <span class=\"token operator\">AND</span> <span class=\"token number\">6000.00</span>\n    <span class=\"token comment\">--AND sp.SalesYTD >= 2000000.00</span>\n    <span class=\"token comment\">--AND sod.UnitPrice &#x3C; 2000</span>\n    <span class=\"token operator\">AND</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">YEAR</span><span class=\"token punctuation\">(</span>soh<span class=\"token punctuation\">.</span>OrderDate<span class=\"token punctuation\">)</span> <span class=\"token operator\">BETWEEN</span> <span class=\"token number\">2014</span> <span class=\"token operator\">AND</span> <span class=\"token number\">2013</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">YEAR</span><span class=\"token punctuation\">(</span>soh<span class=\"token punctuation\">.</span>OrderDate<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">2011</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> p<span class=\"token punctuation\">.</span>LastName<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">.</span>FirstName<span class=\"token punctuation\">,</span> DATEPART<span class=\"token punctuation\">(</span><span class=\"token keyword\">month</span><span class=\"token punctuation\">,</span>soh<span class=\"token punctuation\">.</span>OrderDate<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> p<span class=\"token punctuation\">.</span>LastName<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">.</span>FirstName<span class=\"token punctuation\">,</span> DATEPART<span class=\"token punctuation\">(</span><span class=\"token keyword\">month</span><span class=\"token punctuation\">,</span>soh<span class=\"token punctuation\">.</span>OrderDate<span class=\"token punctuation\">)</span>\n</code></pre>","noteIndex":{"id":"root","title":"root","desc":"","updated":1641013093667,"created":1595961348801,"stub":false,"custom":{"stub":false,"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"DevLog"},"contentHash":"b0b26527a2962dbb8bd5fb9a53ad702f","links":[],"anchors":{},"children":["rzqe5mjn3q2zfscw1roxr20","Bl9NeJmftBQJyJA3X4a6u","inm1S24v2GcN3Quf7gzDb","fmx7cfcdzale0ezna61yq5z","q6tr8q7gahfijix2ktlhcu3","yah6spesmpstech2ue2k3lq","6pxwlugphnw6vm4t8kn0j5p","i17wi8y2hgivywe08h6q6it","1st35wikvph2aew8aana21u","mijr0wvj3qz0mt9pv9xo1jv","qaf8v120h0ffvbowysjxw50","sh4851li2rsrhx47wwsirgv","fwqjigvqyfxiyl3pbpjvgdw","pxdvvln974xhe8w0alh0hoy","n6yddb1smrac5ll3l1y6wbd","g5dllyqoqkenoiz3opalzu6","kbwt8ucy0yh6bo8fl0kv9iw","beykavbe22agsufmm03hu0c","2uvuqa3c15o5r4j7sqadqvr","yr6gzhx0bhzyec6f52y66vf","4no90tcdswtuwmjm0bxnetx"],"parent":null,"data":{},"body":"\nThe hyperfixated rabbit hole diving knowledge base that is my brain looking at technology.\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"randomNote":{},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"sterkere","visibility":"private"},{"fsPath":"Norsk","visibility":"private"},{"fsPath":"DevLog"}],"journal":{"dailyDomain":"log","name":"daily","dateFormat":"yyyy.MM.dd","addBehavior":"childOfCurrent"},"scratch":{"name":"scratch","dateFormat":"yyyy.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"todoIntegration":true,"name":"task","dateFormat":"yyyy.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"wip","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.95.1","enableFullHierarchyNoteTitle":false,"enableHandlebarTemplates":false,"templateHierarchy":"template","enableSmartRefs":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"theme":"custom","enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"assetsPrefix":"/DevLog","copyAssets":true,"siteHierarchies":["root"],"enableSiteLastModified":true,"siteRootDir":"docs","siteUrl":"https://{GITHUB_USERNAME}.github.io","enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"duplicateNoteBehavior":{"action":"useVault","payload":["DevLog"]},"writeStubs":false,"seo":{"title":"Dendron","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"master","editViewMode":"tree"},"enablePrettyLinks":true,"enableTaskNotes":true,"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}
<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><title>Troubleshooting</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="Troubleshooting"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://{GITHUB_USERNAME}.github.io/DevLog/notes/so9y5z1c2e7sjgzgh583ap9/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="4/4/2022"/><meta property="article:modified_time" content="4/14/2022"/><link rel="canonical" href="https://{GITHUB_USERNAME}.github.io/DevLog/notes/so9y5z1c2e7sjgzgh583ap9/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/DevLog/_next/static/css/477fdc912058141b.css" as="style"/><link rel="stylesheet" href="/DevLog/_next/static/css/477fdc912058141b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/DevLog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/DevLog/_next/static/chunks/webpack-193abd745db5a977.js" defer=""></script><script src="/DevLog/_next/static/chunks/framework-bb5c596eafb42b22.js" defer=""></script><script src="/DevLog/_next/static/chunks/main-e26c16bc784f9179.js" defer=""></script><script src="/DevLog/_next/static/chunks/pages/_app-fbacaa7678b5d585.js" defer=""></script><script src="/DevLog/_next/static/chunks/78-13ae6acd5ce7ca5b.js" defer=""></script><script src="/DevLog/_next/static/chunks/373-2f3879190a46a3d9.js" defer=""></script><script src="/DevLog/_next/static/chunks/pages/notes/%5Bid%5D-69449972c2a725d8.js" defer=""></script><script src="/DevLog/_next/static/1h5ulSjjsPnt_rJPFXOd4/_buildManifest.js" defer=""></script><script src="/DevLog/_next/static/1h5ulSjjsPnt_rJPFXOd4/_ssgManifest.js" defer=""></script><script src="/DevLog/_next/static/1h5ulSjjsPnt_rJPFXOd4/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout site-layout" style="margin-top:64px"><section class="ant-layout site-layout"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><section class="ant-layout side-layout-main" style="max-width:1200px;display:initial"><main class="ant-layout-content main-content" role="main" style="padding:0 24px"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="troubleshooting"><a aria-hidden="true" class="anchor-heading icon-link" href="#troubleshooting"></a>Troubleshooting</h1>
<h2 id="issue-with-unable-to-add-drives-to-a-zfs-pool"><a aria-hidden="true" class="anchor-heading icon-link" href="#issue-with-unable-to-add-drives-to-a-zfs-pool"></a>Issue with unable to add drives to a ZFS Pool</h2>
<blockquote>
<p>[EFAULT] Failed to wipe disk da14: [Errno 22] Invalid argument</p>
</blockquote>
<blockquote>
<p>I just want to add my thanks to the OP for creating and particularly to swissroot for the link that made it all come together.</p>
<p>I bought 6 4Tb Seagate drives from a recycler thinking that I could just plug them into my Dell T620 bays and load them up as mirrored vdevs. Its a new build that I'm playing with and while I waited for my H220 flashed to LSI HBA from The Art of Server, I noticed that the H710P raid card could see all the devices but only one was open and usable and five were marked as 'blocked'. That is a well-documented issue that should be fixed by updating the firmware of the card but mine wasn't playing ball. I figured that the H220/LSI would see the drives and make them available when I installed it.</p>
<p>No bueno! The H220 could see the drives but at 0.00Gb; at least I could format them through the BIOS interface for the H220 if only one at a time and 15 hours each. I thought that was the end of the issue but I suspected it might not be.</p>
<p>Fast forward, all got formatted through the H220, I fired up TrueNAS core and it could see all the drives but threw an error when I tried to create the vdevs. Searching that error brought me to this thread and the link provided by swissroot provided the info I needed to sg_format the drives in parallel to a 512 byte sector rather than 520 byte.</p>
<p>For those reading this with the same issue, what I've learned so far is that used HDD are often good value but if they have been used in Netapp/EMC hardware, they need to be mounted on an HBA (not a raid card) and re-formatted to 512 byte sectors in order for them to work and be mounted as useable drives in Freenas/Truenas.</p>
<p>The reason this is pretty unique and hard to track down is that it seems to be an issue that is limited or confined to situations where drives that have been used in other storage arrays that utilise 520 bytes sectors are used in equipment that is looking for 512 byte sectors.</p>
</blockquote>
<h3 id="resolution"><a aria-hidden="true" class="anchor-heading icon-link" href="#resolution"></a>Resolution</h3>
<p><a href="https://bitfix.be/freenas-error-unable-to-gpt-format-the-disk-ada0/">https://bitfix.be/freenas-error-unable-to-gpt-format-the-disk-ada0/</a></p>
<ol>
<li>Login via SSH, execute commands below.
<ul>
<li>if you need to configure
<ul>
<li><code>System > SSH Keypairs > add</code> Generate SSH keypair for root user</li>
<li><code>Accounts > Users > root</code> for root and put public key in appropriate area</li>
<li><code>Services > SSH > Actions (configure)</code> allow <code>Log in as Root with Password</code></li>
<li>On remote machine <code>ssh root@#.#.#.#</code></li>
</ul>
</li>
</ul>
</li>
<li><code>sysctl kern.geom.debugflags=0x10</code></li>
<li><code>dd if=/dev/zero of=/dev/da0 bs=512 count=1</code>
<ul>
<li>My cheat way:
<ul>
<li><code>for disk in $(ls /dev | grep -E "(^da[0-9]$) | (^da1[1-5]$)"); do dd if=/dev/zero of=/dev/$disk bs=512 count=1;done</code></li>
<li>The <code>dd</code> command way might not work so if not resort to the next option</li>
</ul>
</li>
<li>Failsafe
<ul>
<li><code>sg_format --format --size=512 --six -v /dev/da9</code>
<ul>
<li><code>for disk in $(ls /dev | grep -E "(^da[0-9]$) | (^da1[1-5]$)"); do sg_format --format --size=512 --six -v /dev/$disk &#x26;&#x26; echo "$disk reformatteded";done</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Log into web interface and use “View Disks” to wipe the drives in that interface</li>
<li>Create new ZFS volume including these disks.</li>
</ol></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#issue-with-unable-to-add-drives-to-a-zfs-pool" title="Issue with unable to add drives to a ZFS Pool">Issue with unable to add drives to a ZFS Pool</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#resolution" title="Resolution">Resolution</a></div></div></div></div></div></div></div></div></div></main><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></section></section></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"so9y5z1c2e7sjgzgh583ap9","title":"Troubleshooting","desc":"","updated":1649950371194,"created":1649033508110,"custom":{},"fname":"p.doing.homelab.services.truenas.troubleshooting","type":"note","vault":{"fsPath":"DevLog"},"contentHash":"b3d97e6d68dcc134dd2825234e9104bd","links":[],"anchors":{"issue-with-unable-to-add-drives-to-a-zfs-pool":{"type":"header","text":"Issue with unable to add drives to a ZFS Pool","value":"issue-with-unable-to-add-drives-to-a-zfs-pool","line":8,"column":0,"depth":2},"resolution":{"type":"header","text":"Resolution","value":"resolution","line":24,"column":0,"depth":3}},"children":[],"parent":"2sgfr1r4i6jbwoma8b84913","data":{}},"body":"\u003ch1 id=\"troubleshooting\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#troubleshooting\"\u003e\u003c/a\u003eTroubleshooting\u003c/h1\u003e\n\u003ch2 id=\"issue-with-unable-to-add-drives-to-a-zfs-pool\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#issue-with-unable-to-add-drives-to-a-zfs-pool\"\u003e\u003c/a\u003eIssue with unable to add drives to a ZFS Pool\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[EFAULT] Failed to wipe disk da14: [Errno 22] Invalid argument\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI just want to add my thanks to the OP for creating and particularly to swissroot for the link that made it all come together.\u003c/p\u003e\n\u003cp\u003eI bought 6 4Tb Seagate drives from a recycler thinking that I could just plug them into my Dell T620 bays and load them up as mirrored vdevs. Its a new build that I'm playing with and while I waited for my H220 flashed to LSI HBA from The Art of Server, I noticed that the H710P raid card could see all the devices but only one was open and usable and five were marked as 'blocked'. That is a well-documented issue that should be fixed by updating the firmware of the card but mine wasn't playing ball. I figured that the H220/LSI would see the drives and make them available when I installed it.\u003c/p\u003e\n\u003cp\u003eNo bueno! The H220 could see the drives but at 0.00Gb; at least I could format them through the BIOS interface for the H220 if only one at a time and 15 hours each. I thought that was the end of the issue but I suspected it might not be.\u003c/p\u003e\n\u003cp\u003eFast forward, all got formatted through the H220, I fired up TrueNAS core and it could see all the drives but threw an error when I tried to create the vdevs. Searching that error brought me to this thread and the link provided by swissroot provided the info I needed to sg_format the drives in parallel to a 512 byte sector rather than 520 byte.\u003c/p\u003e\n\u003cp\u003eFor those reading this with the same issue, what I've learned so far is that used HDD are often good value but if they have been used in Netapp/EMC hardware, they need to be mounted on an HBA (not a raid card) and re-formatted to 512 byte sectors in order for them to work and be mounted as useable drives in Freenas/Truenas.\u003c/p\u003e\n\u003cp\u003eThe reason this is pretty unique and hard to track down is that it seems to be an issue that is limited or confined to situations where drives that have been used in other storage arrays that utilise 520 bytes sectors are used in equipment that is looking for 512 byte sectors.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"resolution\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#resolution\"\u003e\u003c/a\u003eResolution\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://bitfix.be/freenas-error-unable-to-gpt-format-the-disk-ada0/\"\u003ehttps://bitfix.be/freenas-error-unable-to-gpt-format-the-disk-ada0/\u003c/a\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eLogin via SSH, execute commands below.\n\u003cul\u003e\n\u003cli\u003eif you need to configure\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eSystem \u003e SSH Keypairs \u003e add\u003c/code\u003e Generate SSH keypair for root user\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eAccounts \u003e Users \u003e root\u003c/code\u003e for root and put public key in appropriate area\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eServices \u003e SSH \u003e Actions (configure)\u003c/code\u003e allow \u003ccode\u003eLog in as Root with Password\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eOn remote machine \u003ccode\u003essh root@#.#.#.#\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esysctl kern.geom.debugflags=0x10\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edd if=/dev/zero of=/dev/da0 bs=512 count=1\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003eMy cheat way:\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003efor disk in $(ls /dev | grep -E \"(^da[0-9]$) | (^da1[1-5]$)\"); do dd if=/dev/zero of=/dev/$disk bs=512 count=1;done\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003edd\u003c/code\u003e command way might not work so if not resort to the next option\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eFailsafe\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esg_format --format --size=512 --six -v /dev/da9\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003efor disk in $(ls /dev | grep -E \"(^da[0-9]$) | (^da1[1-5]$)\"); do sg_format --format --size=512 --six -v /dev/$disk \u0026#x26;\u0026#x26; echo \"$disk reformatteded\";done\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eLog into web interface and use “View Disks” to wipe the drives in that interface\u003c/li\u003e\n\u003cli\u003eCreate new ZFS volume including these disks.\u003c/li\u003e\n\u003c/ol\u003e","noteIndex":{"id":"root","title":"root","desc":"","updated":1641013093667,"created":1595961348801,"stub":false,"custom":{"stub":false,"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"DevLog"},"contentHash":"b0b26527a2962dbb8bd5fb9a53ad702f","links":[],"anchors":{},"children":["rzqe5mjn3q2zfscw1roxr20","Bl9NeJmftBQJyJA3X4a6u","inm1S24v2GcN3Quf7gzDb","fmx7cfcdzale0ezna61yq5z","q6tr8q7gahfijix2ktlhcu3","yah6spesmpstech2ue2k3lq","6pxwlugphnw6vm4t8kn0j5p","i17wi8y2hgivywe08h6q6it","1st35wikvph2aew8aana21u","mijr0wvj3qz0mt9pv9xo1jv","qaf8v120h0ffvbowysjxw50","sh4851li2rsrhx47wwsirgv","fwqjigvqyfxiyl3pbpjvgdw","pxdvvln974xhe8w0alh0hoy","n6yddb1smrac5ll3l1y6wbd","g5dllyqoqkenoiz3opalzu6","kbwt8ucy0yh6bo8fl0kv9iw","beykavbe22agsufmm03hu0c","2uvuqa3c15o5r4j7sqadqvr","yr6gzhx0bhzyec6f52y66vf","4no90tcdswtuwmjm0bxnetx"],"parent":null,"data":{},"body":"\nThe hyperfixated rabbit hole diving knowledge base that is my brain looking at technology.\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"randomNote":{},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"sterkere","visibility":"private"},{"fsPath":"Norsk","visibility":"private"},{"fsPath":"DevLog"}],"journal":{"dailyDomain":"log","name":"daily","dateFormat":"yyyy.MM.dd","addBehavior":"childOfCurrent"},"scratch":{"name":"scratch","dateFormat":"yyyy.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"todoIntegration":true,"name":"task","dateFormat":"yyyy.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"wip","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.95.1","enableFullHierarchyNoteTitle":false,"enableHandlebarTemplates":false,"templateHierarchy":"template","enableSmartRefs":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"theme":"custom","enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"assetsPrefix":"/DevLog","copyAssets":true,"siteHierarchies":["root"],"enableSiteLastModified":true,"siteRootDir":"docs","siteUrl":"https://{GITHUB_USERNAME}.github.io","enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"duplicateNoteBehavior":{"action":"useVault","payload":["DevLog"]},"writeStubs":false,"seo":{"title":"Dendron","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"master","editViewMode":"tree"},"enablePrettyLinks":true,"enableTaskNotes":true,"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"so9y5z1c2e7sjgzgh583ap9"},"buildId":"1h5ulSjjsPnt_rJPFXOd4","assetPrefix":"/DevLog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>